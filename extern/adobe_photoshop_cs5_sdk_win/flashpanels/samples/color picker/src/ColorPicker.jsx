/**************************************************************************	ADOBE SYSTEMS INCORPORATED	 Copyright 2008 Adobe Systems Incorporated	 All Rights Reserved.	NOTICE:  Adobe permits you to use, modify, and distribute this file	in accordance with the terms of the Adobe license agreement accompanying	it.  If you have received this file from a source other than Adobe, then	your use, modification, or distribution of it requires the prior written	permission of Adobe.**************************************************************************//**  Filename: ColorPicker.jsx	@author John Huan Vu, Photoshop Engineering Intern, Adobe Systems Incorporated	@fileoverview The script contains four functions to retrieve and set			the background and foreground color. There are also			two utility functions where one converts a color value			retrieved from the Flash panel to RGB values and the			other converts to XML so that the SWF file and the			CSXS Library can parse and use prooperly. This script			is to be used by a SWF file called ColorPicker.swf			created though Adobe Flex.*/try {var colorpicker = new Object;/**	Sets the foreground color on Photoshop.	@param {Integer} color An integer value that's ready to be parsed for RGB values.*/colorpicker.setForeground = function (color){	app.foregroundColor = colorpicker.translateColor(color);}/**	Get the foreground color on Photoshop.	@returns An XML object containing the hex value of the foreground color.	@type String*/colorpicker.getForeground = function (){	xml = "<object>";	xml += colorpicker.convertToXML(app.foregroundColor.rgb.hexValue.toString(), "foreground");	xml += "</object>"	return xml;}/**	Sets the background color on Photoshop.	@param {Integer} color An integer value that's ready to be parsed for RGB values.*/colorpicker.setBackground = function (color){	app.backgroundColor = colorpicker.translateColor(color);}/**	Get the background color on Photoshop.	@returns An XML object containing the hex value of the foreground color.	@type String*/colorpicker.getBackground = function (){	xml = "<object>";	xml += colorpicker.convertToXML(app.backgroundColor.rgb.hexValue.toString(), "background");	xml += "</object>"	return xml;}/**	Pull apart the descriptor for the event the panel recieved.	@returns An XML object containing the hex value of the foreground color.	@type String*/colorpicker.dumpDescriptor = function (indescIDFromSWF){	var id = Number(indescIDFromSWF); 	var desc = new ActionDescriptor();	desc.fromID(id);	LogIt("Descriptor count:" + desc.count + "\n");	var xmlDesc = colorpicker.descriptorToXML(desc);	xml = "<object>";	xml += colorpicker.convertToXML(desc.count, "count");	xml += colorpicker.convertToXML(xmlDesc, "descriptor")	xml += "</object>"	return xml;}/**	Convert the ActionDescriptor to XML	@returns An XML describing the ActionDescriptor*/colorpicker.descriptorToXML = function (desc){	var descXML;	return descXML;}/**	Take the integer value corresponding to a color and parse the values for	red, green, and blue to SolidColor.	@param {Integer} c An integer value that's ready to be parsed for RGB values.	@returns The type SolidColor with red, green, and blue values parsed from "c".	@type SolidColor*/colorpicker.translateColor = function (c){	var color = new SolidColor;	color.rgb.red 	= (c >> 16) & 0xFF;	color.rgb.green = (c >> 8) & 0xFF;	color.rgb.blue 	= c & 0xFF;	return color;}/**	In order to communicate to the SWF file, it must be written as an XML		containing the property and identifier. This utility is very helpful for		a two-way communication between the JSX and SWF.	@param {String} property The property or value for the identifier	@param {String} identifier The unique identifier for the property	@returns An xml containing the property and identifier	@type String*/colorpicker.convertToXML = function (property, identifier){	var type = typeof property;	var xml = '<property id = "' + identifier + '" >';		switch(type){		case "number":			xml += "<number>";			xml += property.toString();			xml += "</number>";			break;		case "boolean":			xml += "<" + property.toString() + "/>";			break;		case "string":			xml += "<string>";			xml += property.toString();			xml += "</string>";			break;		case "object":			// Object case is currently not supported			alert("Object case is currently not supported");			//xml += "<object>";			//for(var i in property)			//	xml += convertToXML(property[i], 			//xml += "</object>";			break;		case "undefined":			xml += "<string>undefined</string>";			break;		default:			alert("Type " + type + " is unknown.");			return "";	}	xml += '</property>';	return xml;}/**	Get the version string from Photoshop so we can try to be compatible with	older versions.*/colorpicker.getVersion = function () {	xml = "<object>";	xml += colorpicker.convertToXML(app.version, "version");	xml += "</object>"	return xml;}/**	Get the application bit mode Photoshop.*/colorpicker.getAppBitMode = function () {	var appBitMode = 32;	try { 		var ref = new ActionReference();		ref.putProperty( charIDToTypeID( 'Prpr' ), charIDToTypeID( 'Sz  ' ) );		ref.putEnumerated( charIDToTypeID( 'capp' ),  charIDToTypeID( 'Ordn' ), charIDToTypeID( 'Trgt' ) );		var desc = executeActionGet( ref );		appBitMode = desc.getDouble( charIDToTypeID( 'Sz  ' ) );	}	catch(e) {		// older versions like CS4 will not have this key		// running this on CS4 in 64 bit mode will be wrong for example	}	xml = "<object>";	xml += colorpicker.convertToXML(appBitMode, "appBitMode");	xml += "</object>"	return xml;}colorpicker.LogIt = function ( inMessage ) {	try {		var a = new colorpicker.Logger();		var b = decodeURIComponent( inMessage );		a.log( b );	}	catch(e) {		alert(e + ":" + e.line);	}}///////////////////////////////////////////////////////////////////////////////// Object: Logger// Usage: Log information to a text file// Input: String to full path of file to create or append, if no file is given//        then output file Logger.log is created on the users desktop// Return: Logger object// Example:////   var a = new Logger();//   a.print( 'hello' );//   a.print( 'hello2\n\n\nHi\n' ) ;//   a.remove();//   a.log( Date() );//   a.print( Date() );//   a.display();/////////////////////////////////////////////////////////////////////////////////colorpicker.Logger = function ( inFile ) {	// member properties	// the file we are currently logging to	if ( undefined == inFile ) {		this.file = new File( Folder.desktop + "/ColorPicker.log" );	} else {		this.file = new File( inFile );	}		// member methods		// output to the ESTK console	// note that it behaves a bit differently 	// when using the BridgeTalk section	this.print = function( inMessage ) { 		if ( app.name == "ExtendScript Toolkit" ) {			print (inMessage);		} else {			var btMessage = new BridgeTalk();			btMessage.target = "estoolkit";			btMessage.body = "print(" + inMessage.toSource() + ")";			btMessage.send ();		}	}	// write out a message to the log file	this.log = function( inMessage ) {		if ( this.file.exists ) {			this.file.open( 'e' );			this.file.seek( 0, 2 ); // end of file		} else {			this.file.open( 'w' );		}		this.file.write( inMessage );		this.file.close();	}	// show the contents with the execute method	this.display = function() {		this.file.execute();	}	// remove the file	this.remove = function() {		this.file.remove();	}	}colorpicker.LogIt("ColorPicker.jsx loaded\n");}catch(e) {	alert("ColorPicker error: " + e + " : " + e.line);}