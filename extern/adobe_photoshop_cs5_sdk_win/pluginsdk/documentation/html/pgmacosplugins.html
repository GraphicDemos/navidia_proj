<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!--
/*
    Copyright 2005-2006 Adobe Systems Incorporated
    Distributed under the MIT License (see accompanying file LICENSE_1_0_0.txt
    or a copy at http://opensource.adobe.com/licenses.html)
*/
Some files are held under additional license. Please see "licenses.html" for more information.
-->

<head>
    <TITLE>Adobe Photoshop SDK: Creating plug-in modules for the Mac OS</TITLE>
    <META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1"/>
    <LINK TYPE="text/css" REL="stylesheet" HREF="basic.css"/>
    <STYLE TYPE="text/css" MEDIA="all"><!--
        @import url("modern.css");
    --></STYLE>
    <LINK TYPE="text/css" REL="stylesheet" HREF="print.css" MEDIA="print"/>
    <LINK TYPE="text/css" REL="stylesheet" HREF="mainnav.css"/>
    <LINK TYPE="text/css" REL="stylesheet" HREF="stlab.css"/>
	<link href="adobetabs.css" rel="stylesheet" type="text/css">
<!-- 
    <LINK REL="alternate" TITLE="opensource.adobe.com RSS" HREF="http://sourceforge.net/export/rss2_projnews.php?group_id=132417&amp;rss_fulltext=1" TYPE="application/rss+xml"/>
-->
</HEAD>

<body bgcolor="white">

<div id="mainnav" width="100%">
<table width="100%" border="0"><tr><td width="50%">
<a title="Adobe Systems home page" href="http://www.adobe.com/" tabindex="2"><img src="images/logo.gif" alt="Adobe Systems, Inc." height="80" width="150"/></a>
</td><td align="right" valign="top">
<a href="index.html" class="el" target="_top"><font size="+2" color="black">Adobe Photoshop SDK</font></a><br/>
<!--
<a href="http://opensource.adobe.com" class="el" target="_top"><font size="-2" color="black">opensource.adobe.com</font></a>
-->
</td></tr></table>

</div>
<br/>
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<tr><td width="10" nowrap="1"> </td>
<td valign="top">
    <table border="0" bgcolor=#ededed cellpadding="5">
    <tr><td nowrap="1">
        <h3 class="navbar">Getting Started</h3>
        <ul>
            <li><a href="ProgrammersGuideIntro.html">Home</a></li>
            <li><a href="index.html">New for CS5</a></li>
	        <li><a href="SixtyFourMacintosh.html">Making 64 bit plug-ins for Macintosh</a></li>
	        <li><a href="SixtyFour.html">Making 64 bit plug-ins for Windows</a></li>
            <li><a href="faqs.html">Frequently Asked Questions</a></li>
            <li><a href="tutorialsexamples.html">Tutorials and Examples</a></li>
			<li><a href="DeveloperResources.html">Developer Resources</a></li>
        </ul>
        <h3 class="navbar">SDK API Reference</h3>
        <ul>
			<li><a href="annotated.html">Data Structure List</a></li>
		    <li><a href="classes.html">Data Structure Index</a></li>
			<li><a href="functions.html">Member Index</a></li>
			<li><a href="files.html">File List</a></li>
		    <li><a href="globals.html">File Member Index</a></li>
        </ul>
        <h3 class="navbar">SDK API Features</h3>
        <ul>
            <li><a href="rgcallbacks.html">Callbacks</a></li>
			<li><a href="pluginmodules.html">Plug-in Modules</a></li>
		    <li><a href="memorymanagement.html">Memory Management</a></li>
			<li><a href="resourcemanagement.html">Resource Management</a></li>
			<li><a href="pixelmanagement.html">Pixel Management</a></li>
			<li><a href="colormanagement.html">Color Management</a></li>
			<li><a href="automation.html">Actions and Automation</a></li>
			<li><a href="filehandling.html">File Handling</a></li>
        </ul>
<!--  Moved to link under "Other Documentation"
        <h3 class="navbar">Progammer's Guide</h3>
        <ul>
            <li><a href="PGPlugInBasics.html">Plug-in Basics</a></li>
            <li><a href="PGPlugInTypes.html">Plug-in Types</a></li>
            <li><a href="PGPlugInInterface.html">Plug-in Interface</a></li>
            <li><a href="PGMemoryMgmtStrategies.html">Memory Management Strategies</a></li>
            <li><a href="PGMacOSPlugins.html">Creating Mac OS Plug-ins</a></li>
            <li><a href="PGWinPlugins.html">Creating Windows Plug-ins</a></li>
            <li><a href="PGCallbacks.html">Callbacks and Callback Suites</a></li>
            <li><a href="PGWritingPlugins.html">Writing Plug-ins</a></li>
			<li><a href="PGScriptingPlugins.html">Scripting Plug-ins</a>
		    <li><a href="pgpiplresources.html">Creating PiPL Resources</a></li>
		    <li><a href="pgsamplecode.html">Sample Code</a></li>
		    <li><a href="glossary.html">Glossary of Acronyms</a></li>
        </ul>
-->
        <h3 class="navbar">Other Documentation</h3>
        <ul>
          <li><a href="MachOConversion.html">Converting to Mach-O format</a></li>
          <li><a href="MakingXCodeProjects.html">Making XCode Projects for Mac OS</a></li>
          <li><a href="ProgrammersGuideMain.html">SDK Programmer's Guide</a></li>
		      <li><a href="../PICA.pdf">Adobe PICA API</a>
		      <li><a href="../ADMReferenceGuide.pdf">Adobe Dialog Manager</a>
        </ul>
<!--  Moved to Link under "Getting Started".
        <h3 class="navbar">Developer Resources</h3>
        <ul>
			<li><a href="http://partners.adobe.com/public/developer/photoshop/devcenter.html">Adobe Photoshop Developer Center</a>
            <li><a href="mailinglistandforum.html">Suppport</a></li>
            <li><a href="technicalnotes.html">Technical Notes</a></li>
            <li><a href="license.html">SDK License Agreements</a></li>
        </ul>
-->
    </td></tr>
    </table>
</td>

<td width="10" nowrap="1"> </td>
<td width="100%" valign="top">

<!-- End Header -->

<!-- Generated by Doxygen 1.4.7 -->
<h1><a class="anchor" name="PGMacOSPlugins">Creating plug-in modules for the Mac OS</a></h1><b>Sections on this Page</b><ul>
<li><a class="el" href="pgmacosplugins.html#PGSysConfig">Hardware and system software configuration</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSResources">Resources in a plug-in module</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSGlobals">Global variables</a></li><li><a class="el" href="pgmacosplugins.html#PGSegmentation">Segmentation</a></li><li><a class="el" href="pgmacosplugins.html#PGCWLinkFlags">Metrowerks CodeWarrior link flags for plug-ins over 32k</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSInstallModule">Installing plug-in modules</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSPluginDir">Finding the plug-in directory for the Mac OS</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSSDKContents">What’s in this toolkit for the Mac OS?</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSPPC">Fat and PPC-only plug-ins and the cfrg resource</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOS680x0">Building 680x0–only plug-ins</a></li><li><a class="el" href="pgmacosplugins.html#PGMacOSCWDebugging">Debugging code resources in Metrowerks CodeWarrior</a></li></ul>
<p>
Photoshop plug-in modules for the Macintosh can be created using any of the popular C compilers including Apple MPW, Symantec C++, or Metrowerks CodeWarrior. The example plug-ins in this toolkit include both MPW makefiles and CodeWarrior project files.<p>
You can create plug-in modules for 680x0, PowerPC, or both (fat binaries). If your plug-in module uses floating point arithmetic, you can create plug-in code that is optimized for Macintosh systems with floating-point units (FPU). If you desire, you can also provide a version of your code that does not require an FPU, and Photoshop will execute the proper version depending on whether an FPU is present.<p>
Plug-in modules use code resources on 680x0 Macs and shared libraries (the code fragment manager) on PowerPC systems.<p>
When the user performs an action that causes a plug-in module to be called, Photoshop opens the resource fork of the file the module resides in, loads the code resource (68k) or shared library (PowerPC) into memory. On 680x0 systems, the entry point is assumed as the first byte of the resource.<h2><a class="anchor" name="PGSysConfig">
Hardware and system software configuration</a></h2>
Adobe Photoshop plug-ins assume that the Macintosh has 128K or larger ROMs, System 6.0.2 or later. Photoshop 3.0 and later requires System 7.<p>
Photoshop 5.0 and later are PPC only.<p>
Many users still work with older versions of Photoshop. If you choose to support versions of Photoshop prior to 3.0, your plug-in may be called from machines as old as the Mac Plus. You should use the Gestalt routines to check for 68020 or 68030 processors, math co-processors, 256K ROMs, and Color or 32-Bit QuickDraw if they are required.<p>
If your plug-in only runs with Photoshop 3.0, you can assume the features are present that are requirements of Photoshop 3.0: a 68020 or better, Color QuickDraw, and 32-Bit QuickDraw.<h2><a class="anchor" name="PGMacOSResources">
Resources in a plug-in module</a></h2>
Besides 680x0 code resources, a plug-in module may include a variety of resources for the plug-in’s user interface, stored preferences, and any other useful resource.<p>
Every plug-in module must include either a complex data structure stored in a PiPL resource or a simpler structure in a PiMI resource. These resources provide information that Adobe Photoshop uses to identify plug-ins when Photoshop is first launched and when a plug-in is executed by the user. All the examples in this toolkit build both resources for downward- and cross-application compatibility.<p>
PiMIs, PiPLs and other resources are discussed in detail in the <a href="../Plug-in Resource Guide.pdf">Cross Application Plug-in Development Resource Guide</a> which is included with this kit. This document discusses cross-application plug-in development and describes the different file and code resources recognized by Photoshop and other host applications.<h2><a class="anchor" name="PGMacOSGlobals">
Global variables</a></h2>
Most Macintosh applications reference global variables as negative offsets from register A5 on 680x0 processors. If a plug-in module declares any global variables, their location would overlap Photoshop’s global variable space. Using them generally results in a quick and spectacular crash.<p>
Often you can end up using them without even realizing it. Explicit literal string assignments, for instance, take up global space when first initialized. One way around this is to store strings in a <code>'STR</code> ' or <code>'STR#'</code> resource and access them using the Macintosh toolbox calls <code>GetString()</code> and <code>GetIndString()</code>.<p>
<b>CWA4Globals Metrowerks CodeWarrior A4-globals </b><p>
Code resources can avoid the A5 problem by using the A4 register in place of the A5 register. The Metrowerks CodeWarrior C compiler contains header files (SetupA4.h, A4Stuff.h) and pre–compiled libraries designed for A4 register usage. The examples in this toolkit all initialize and set-up the A4 register, so you can refer to them for more detail.<p>
If you are building a plug-in module to run on 680x0 systems you should not declare any global variables in your plug-in module code unless you specifically use the A4 support provided with your compiler. Refer to your compiler documentation for more details.<p>
Plug-in modules that are compiled native for PowerPC systems do not have this limitation, since they use the code fragment manager (CFM) instead of code resources. If your plug-in module only runs on PowerPC, you may safely declare and use global variables. Refer to the appropriate Apple documentation for more information.<p>
If you need global data in your 680x0 compatible plug-in module, one alternative to using A4 is to dynamically allocate a new block of memory at initialization time using the Photoshop Handle or Buffer suite routines, and return this to Photoshop in the data parameter. Photoshop will save this reference and return it to your plug-in each time it is called subsequently. The example plug-ins in this toolkit all use this approach.<h2><a class="anchor" name="PGSegmentation">
Segmentation</a></h2>
Macintosh 680x0 applications have a special code segment called the jump table. When a routine in one segment calls a routine in another segment, it actually calls a small glue routine in the jump table segment. This glue routine loads the routine’s segment into memory if needed, and jumps to its actual location.<p>
The jump table is accessed using positive offsets from register A5. Since Photoshop is already using A5 for its jump table, the plug-in cannot use a jump table in the standard way.<p>
The simplest way to solve this is to link all the plug-in’s code into a single segment. This usually requires setting optional compilation/link flags in your development environment if the resultant segment exceeds 32k.<h2><a class="anchor" name="PGCWLinkFlags">
Metrowerks CodeWarrior link flags for plug-ins over 32k</a></h2>
For over 32k length plug-ins under Metrowerks CodeWarrior, enable these processor preferences: code model: large; far data; far method tables; and far string constants:<p>
Enable the linker preference link single segment:<h2><a class="anchor" name="PGMacOSInstallModule">
Installing plug-in modules</a></h2>
To install a plug-in module, drag the module’s icon to either the same folder as the Adobe Photoshop application, or the plug-ins folder designated in your Photoshop preferences file. Photoshop 3.0 searches for plug-ins in the application folder, and throughout the tree of folders underneath the designated plug-ins folder. Aliases are followed during the search process. Folders with names beginning with "¬" (Option-L on the Macintosh keyboard) are ignored.<h2><a class="anchor" name="PGMacOSPluginDir">
Finding the plug-in directory for the Mac OS</a></h2>
To find the plug-in directory on Mac OS in versions of Photoshop before 5.0 you have to search for the application and try to find a folder called <code>Plug-ins</code>.<p>
In Photoshop 5.0 and later, in the <code>System Folder</code>, in the <code>Preferences</code> folder is a file with paths to the application and plug-ins folder.<p>
<table border="1" 
 summary="Photoshop 5 Paths filenames" cellspacing="3" cellpadding="3">
<caption align="bottom"><em>Photoshop 5 Paths filenames</em></caption>
<tr>
<th>Application </th><th>Paths filename </th></tr>
<tr>
<td>Adobe Photoshop 5.0 </td><td>Adobe Photoshop 5 Paths </td></tr>
<tr>
<td>Adobe Photoshop 5.0 Limited Edition </td><td>Adobe Photoshop LE Paths </td></tr>
<tr>
<td>Adobe Photoshop 5.0 Tryout/Demo </td><td>Adobe Photoshop 5 Demo Paths </td></tr>
</table>
<p>
<dl compact><dt><b>Note:</b></dt><dd>The Photoshop 5 Paths file contains two Macintosh <code>FSSPec</code> structures one right after the other. The first is to the application; the second is to the plug-in directory. There is no padding or sentinal characters.<p>
The Photoshop CS3 Paths file contains the information above for Photoshop 5 paths. Following that are two Macintosh UTF8 string paths, one right after the other. The first is to the application; the second is to the plug-in directory.</dd></dl>
<h2><a class="anchor" name="PGMacOSSDKContents">
What’s in this toolkit for the Mac OS?</a></h2>
This toolkit contains documentation, and literature on the Adobe Developers Association, and examples specifically written for the Mac OS.<p>
<b>Examples</b> <br>
 The plug-ins included with this toolkit can be built using Apple MPW or Metrowerks CodeWarrior. They have been tested against the latest Metrowerks CodeWarrior. Version notes are in the SDK Readme file.<p>
<b>Sources.cpp and Headers.h </b> <br>
 <code><a class="el" href="_p_i_general_8h.html">PIGeneral.h</a></code> and <code><a class="el" href="_p_i_types_8h.html">PITypes.h</a></code> contain definitions useful across multiple plug-ins. <code><a class="el" href="_p_i_about_8h.html">PIAbout.h</a></code> contains the information for the about box call for all plug-in types. <code><a class="el" href="_p_i_actions_8h.html">PIActions.h</a></code> contains the information for the Actions suite callbacks for all plug-in types. <code><a class="el" href="_p_i_acquire_8h.html">PIAcquire.h</a></code>, <code><a class="el" href="_p_i_export_8h.html">PIExport.h</a></code>, <code><a class="el" href="_p_i_filter_8h.html">PIFilter.h</a></code>, <code><a class="el" href="_p_i_format_8h.html">PIFormat.h</a></code>, <code><a class="el" href="_p_i_picker_8h.html">PIPicker.h</a></code>, and <code><a class="el" href="_p_i_selection_8h.html">PISelection.h</a></code> are the header files for the respective types of plug-in modules.<p>
<b>Utilities </b> <br>
 <code>DialogUtilities.c</code> and <code>DialogUtilities.h</code> provide general support for doing things with dialogs including creating movable modal dialogs which make appropriate calls back to the host to update windows, as well as simple support for putting data back into the dialog for display, such as <code>StuffNumber()</code> and <code>StuffText()</code>.<p>
<code>PIUtilities.c</code> and <code>PIUtilities.h</code> contain various routines and macros to make it easier to use the host callbacks. The macros make assumptions about how global variables are being handled and declared; refer to the example source code to see how <code>PIUtilities</code> is used.<p>
<b>Documentation </b> <br>
 Photoshop SDK Guide.pdf is this guide. <a href="../Plug-in Resource Guide.pdf">Cross Application Plug-in Development Resource Guide</a> is a reference tool for developing Photoshop plug-ins that work with all of Adobe’s major graphical applications.<p>
It also includes information on host applications and their use of different code and file resources such as PiMI and PiPL resources. Actions Event Guide.pdf is a reference tool for developing a Photoshop 5.0 automation plug-in.<p>
<b>Developer Services</b> <br>
 The Developer Services directory provides information and an application for the Adobe Developers Association, which provides not only support for this and the other Adobe toolkits, but marketing and business resources for third party developers.<h2><a class="anchor" name="PGMacOSPPC">
Fat and PPC-only plug-ins and the cfrg resource</a></h2>
Adobe Photoshop 4.0 and 5.0 use the PiPL resource (see Plug-in Resource Guide.pdf) to identify the type of processor for which the plug-in module was compiled: 680x0, PowerPC or both. The Macintosh OS uses a different resource, 'cfrg', to indicate the presence of code for the PowerPC microprocessor. The cfrg resource is automatically generated by the Metrowerks CodeWarrior development environment.<p>
Normally, this is not a problem. It could become a problem, however, if you or a user of your plug-in run an application to reduce a fat binary (680x0 and PowerPC) plug-in to 680x0 only. Fat stripper applications search for cfrg resources and when found remove any PowerPC code and the cfrg resource. These applications are not aware of the PiPL resource; the resulting 680x0-only plug-in will still indicate that it contains PowerPC code.<p>
After you create a PowerPC plug-in module, you should manually remove the cfrg resource with a resource editor to prevent someone from accidently deleting the PowerPC code by stripping.<p>
You should always be sure to specify the correct PiPL code descriptors when building a plug-in. All of the plug-ins in the examples folder have PiPL resources with both code descriptors, as follows: <div class="fragment"><pre class="fragment"><span class="preprocessor">#if Macintosh</span>
<span class="preprocessor"></span>    Code68K { '8BIF', $$ID },
    CodePowerPC { 0, 0, <span class="stringliteral">""</span> },
<span class="preprocessor">#endif</span>
</pre></div><p>
If your plug-in module includes code only for the 680x0 or only for the PowerPC, remove the other code descriptor before compiling the <code>.r</code> file. For instance, a PowerPC-only plug-in module’s PiPL source file would have these lines in the PiPL descriptor: <div class="fragment"><pre class="fragment"><span class="preprocessor">#if Macintosh</span>
<span class="preprocessor"></span>    CodePowerPC { 0, 0, <span class="stringliteral">""</span> },
<span class="preprocessor">#endif</span>
</pre></div><p>
<b>Building your plug-in in older IDE than CodeWarrior Pro </b> <br>
 Metrowerks CodeWarrior Pro introduced multiple targets. You can now build 68K and PPC code from within one project.<p>
Building your plug-ins with Metrowerks CodeWarrior in older IDEs is a two-step process. Open and build the 680x0 project to create the <code>.rsrc</code> and 68k code for the plug-in. Then, you must open and build the PowerPC project to create the actual plug-in module and roll the 68k and PPC resources together in the plug-in.<p>
If you do not build the 680x0 project, the initial <code>.rsrc</code> resource file with the appropriate dialog and PiPL resources will not be built. If you do not build the PowerPC project, the actual plug-in file will not be created. To build from one project file (68k-only) see the following information for CodeWarrior Bronze users.<h2><a class="anchor" name="PGMacOS680x0">
Building 680x0-only plug-ins</a></h2>
The sample CodeWarrior project files in this toolkit are designed for CodeWarrior Gold to create "fat" binaries. If you use CodeWarrior to build 680x0-only plug-in modules, you should make two changes to the sample files.<p>
First, you should change the Project preferences to output a plug-in file with the correct file name, creator, and type. (The 68K project files included in the toolkit output resource files which are then used by the PPC project files, as explained above.)<p>
For example, the 680x0 project in the Filters sample is set to output a code resource named <code>Dissolve.rsrc</code> with creator <code>'Doug'</code> and type <code>'RSRC'</code>. You should change these to <code>Dissolve</code>, <code>'8BIM'</code>, and <code>'8BFM'</code> respectively.<p>
Second, you should recompile the PiPL resource after removing the PowerPC code descriptor. The PiPL statement: <div class="fragment"><pre class="fragment"><span class="preprocessor">#if Macintosh</span>
<span class="preprocessor"></span>    Code68K { '8BIF', $$ID },
    CodePowerPC { 0, 0, <span class="stringliteral">""</span> },
<span class="preprocessor">#endif</span>
</pre></div> should be changed to: <div class="fragment"><pre class="fragment"><span class="preprocessor">#if Macintosh</span>
<span class="preprocessor"></span>    Code68K { '8BIF', $$ID },
<span class="preprocessor">#endif</span>
</pre></div><p>
See Plug-in Resource Guide.pdf for more information about PiPL resources.<h2><a class="anchor" name="PGMacOSCWDebugging">
Debugging code resources in Metrowerks CodeWarrior</a></h2>
<ol type=1>
<li>Drag the <code>.SYM</code> file out of the development directory where it is linked to the <code>.rsrc</code> file. The desktop is fine.</li><li>Double-click the <code>.SYM</code> file to run the Metrowerks Debugger.</li><li>When it asks "Where is my resource?" select your plug-in in the Photoshop plug-in folder. Even if your plug-in is an alias, select the one that is in Photoshop’s Plug-ins folder, not the one that may be sitting in your development directory (next to your <code>.rsrc</code> file).</li><li>Drag the Photoshop icon on top of the Metrowerks Debugger to link Photoshop to the debugger.</li><li>Double-click the Photoshop icon to launch the application.</li><li>Set your breakpoints in your <code>.SYM</code> window in the debugger.</li><li>Bring the Photoshop debugger window to the front and choose Run.</li><li>In Photoshop, run your plug-in. You should hit your break-point and go back to the debugger automatically.</li></ol>
<p>
<dl compact><dt><b>Note:</b></dt><dd>Your variables may not read their true values correctly as you step through your code. They may be valid only at your breakpoints. </dd></dl>

<!-- Begin Footer -->
</td>
<td width="20">&nbsp;&nbsp;</td>
</table>

<div id="footerrow"><!--give footer 25px of white above--></div>
<div id="footer" title="footer: links to copyright and other legal information">
<p><a href="licenses.html" class="el">&copy; 2010 Adobe Systems Incorporated</a></p>
<a title="Terms of Use" href="http://www.adobe.com/misc/copyright.html">Terms of Use - </a>
<a title="Privacy Policy" href="http://www.adobe.com/misc/privacy.html">Privacy Policy - </a>
<a href="http://access.adobe.com">Accessibility - </a>
<a title="Avoid software piracy" href="http://www.adobe.com/aboutadobe/antipiracy/main.html">Avoid software piracy - </a>
<a title="Permissions and trademarks" href="http://www.adobe.com/misc/agreement.html">Permissions and trademarks - </a>
<a title="Product License Agreements" href="http://www.adobe.com/products/eulas/main.html">Product License Agreements</a></div>
<p/>
</body>
</html>
